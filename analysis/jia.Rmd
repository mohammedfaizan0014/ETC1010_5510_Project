---
title: "ETC1010-5510 Project - T11_Wed_skimr"
subtitle: "A Report On The LinkedIn-World Bank Data for Development"
author: "Hanchen Wang 30704456, Hao Li 32041594, Jiaying Zhang 30930685, Mohammed Faizan 31939872, Karan Garg 32106580"
date: "28 April 2021"
output: 
  bookdown::html_document2
keep_md: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#loading packages

library(tidyverse) 
library(plotly)
library(naniar)
library(visdat)
library(bookdown)
library(knitr)
library(ggplot2)
library(lubridate)
library(geosphere)
library(ggmap)
library(ggthemes)
library(maps)
library(patchwork)
library(here)
library(readxl)
library(readr)
library(rpart)
library(broomstick)
```
#QUESTIONS

2) **What is the average percentage of net migration for each industry over the past five years and Is the growth rate of immigration within the industry related to the growth rate of the industry?**


All the Talent Migration metrics are based on net migration (arrivals minus departures). These net migration figures are normalized by LinkedIn member count in a given country to enable fairer comparisons across samples. For example, considering Canada as the country of interest, net flows of migrants to/from the US in absolute terms are normalized by total LinkedIn membership count in Canada. Similar method is used for calculating the skill and industry gains/loss associated with bilateral migration flows. We calculate all on an annual basis, and report an average of the last three years. To protect member privacy, LinkedIn only shows aggregated data with at least 50 observations. Blanks above are generally due to bilateral flows not crossing this threshold, or countries only having net gains or losses on LinkedIn. Since LinkedIn data has better coverage of white-collar workers in knowledge-intensive services sectors, these migration flows are unlikely representative of the entire migration landscape of a country, but can shed light on some of the most dynamic and innovative sectors.
```{r read-data}
mgindustry <- read_csv(here::here("data/2_migration_industry.csv"))
growindustry<- read_excel(here::here('data/456_employment_growth.xlsx'), sheet=4)
```
```{r datacleaning, include=FALSE}
mguse <- mgindustry %>% 
  select(industry_name,
         industry_id,
         isic_section_index,
         isic_section_name,
                net_per_10K_2015,
                net_per_10K_2016,
                net_per_10K_2017,
                net_per_10K_2018,
                net_per_10K_2019) %>% 
  filter(isic_section_name != 'Not_mapped') %>% 
  filter(isic_section_name %in% unique(growindustry$isic_section_name)) %>%
   rename(c("2015"= "net_per_10K_2015",
           "2016"= "net_per_10K_2016",
           "2017"= "net_per_10K_2017",
           "2018"= "net_per_10K_2018",
           "2019"= "net_per_10K_2019")) %>% 
    pivot_longer(cols = 5:9,  
               names_to = "year",            
               values_to = "net_per_10K_migration_rate") 
```
2.1 Average percentage of net migration for each industry Section and industry over the past five years


```{r mgave}
mgave <- mguse %>% 
  group_by(isic_section_name,industry_name, year) %>% 
  summarise(average_migration_rate = mean(net_per_10K_migration_rate, na.rm = TRUE)) 
```

```{r vis, fig.width=12, fig.cap="Net migration for each industry section"}
mgvis <- mgave %>%
ggplot(aes(isic_section_name,
           average_migration_rate,
           fill= isic_section_name)) +
  geom_boxplot() + 
  ggtitle("Net migration for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis)
```

```{r vis3, fig.width=12, fig.cap="The industry with highest net migration rate for each industry section"}

# industry with highest migration rate for each section, over 2014 to 2018 
mgvis2 <- mgave %>%
  group_by(isic_section_name, industry_name)  %>% 
  arrange(desc(average_migration_rate)) %>%
  slice_max(average_migration_rate,n=1) %>% 
  group_by(isic_section_name)  %>% 
  slice_max(average_migration_rate,n=1) %>% 
ggplot(aes(industry_name,
       average_migration_rate,
       fill = isic_section_name)) +
  geom_col()+
   ggtitle("The industry with highest net migration rate for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis2)
```


```{r relationdata}
growuse <- growindustry %>% 
  select(industry_name, 
         industry_id,
         isic_section_name,
                growth_rate_2015,
                growth_rate_2016,
                growth_rate_2017,
                growth_rate_2018,
                growth_rate_2019) %>% 
   rename(c("2015"= "growth_rate_2015",
           "2016"= "growth_rate_2016",
           "2017"= "growth_rate_2017",
           "2018"= "growth_rate_2018",
           "2019"= "growth_rate_2019"
           )) %>% 
    pivot_longer(cols = 4:8,  
               names_to = "year",            
               values_to = "growth_rate") 
growclean <- growuse %>% 
  mutate(growth_rate = str_sub(growuse$growth_rate,start = 1, end = -2))%>% 
  mutate(growth_rate = as.numeric(growth_rate))
```

```{r growave}
growave <- growclean %>% 
  group_by(isic_section_name,industry_name, year) %>% 
summarise(average_grow_rate = mean(growth_rate, na.rm = TRUE))
```
```{r full}
fulldata<- mgave %>% 
  inner_join(growave)

mg_grow_model <- rpart(average_grow_rate~average_migration_rate, data = fulldata)
df_rp_aug <- augment(mg_grow_model)
```

```{r}
ggplot(df_rp_aug,
       aes(x = average_migration_rate,
           y = average_grow_rate)) +
  geom_point() +
  geom_line(aes(y = .fitted), colour = "salmon", size = 2) 

#no relation between migration rate and growth rate
```




