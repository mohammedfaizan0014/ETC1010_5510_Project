---
title: "ETC1010-5510 Project - T11_Wed_skimr"
subtitle: "A Report On The LinkedIn-World Bank Data for Development"
author: "Hanchen Wang 30704456, Hao Li 32041594, Jiaying Zhang 30930685, Mohammed Faizan 31939872, Karan Garg 32106580"
date: "28 April 2021"
output: 
  bookdown::html_document2
keep_md: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#loading packages

library(tidyverse) 
library(plotly)
library(naniar)
library(visdat)
library(bookdown)
library(knitr)
library(ggplot2)
library(lubridate)
library(geosphere)
library(ggmap)
library(ggthemes)
library(maps)
library(patchwork)
library(here)
library(readxl)
library(readr)
```


**TUTOR: Samantha Dawson**

**LECTURER: Patricia Menéndez**

# Project and Data Description

## The LinkedIn-World Bank Digital Data for Development: Industry Jobs and Skills Trends

"The World Bank Group and LinkedIn have created the Digital Data for Development collaboration to support innovative policy decisions as developing countries grapple with a rapidly changing global economy. With hundreds of millions of members worldwide, LinkedIn has the potential to offer a new, timely, and granular source of data about emerging industries, workers’ changing skills composition and how they’re engaging with labor markets globally." ~ [1](https://linkedindata.worldbank.org/about)

This collaboration enables government and policy makers to drive better policy implementations,  thus creating opportunities to the global work force. The data represents LinkedIn members' data based on four metrics: Industry Employment Shifts, Talent Migration, Industry Skills Needs and Skills Penetration. The records in the data represent over 100 countries having a distribution across six major industry sectors(representing 148 industries): Financial Services, Professional Services, Information & Communication Technology (ICT), the Arts & Creative Industries, Manufacturing, and Mining/Quarrying and possessing skills within the over 50,000 distinct, standardized skills classified by LinkedIn into 249 skill groups, further categorised as: Business Skills, Disruptive Tech Skills, Soft Skills, Specialized Industry Skills and Tech Skills.  

For our project, we will be working on the following questions.

#QUESTIONS

Q1) Which skill category is most common across all Industry Sections and how does it vary between each section? **(Hao Li)**

##data description: The data is about what skills are needed most in different industries. 

The file from the source is tidy and does not require further cleaning. The industry skills needs metric captures which skills are most likely to be added to a member's profile in one industry compared to other industries.

The most common skill category across different sections is Business Skills. 

```{r, fig.width=8,fig.height=4}
mydat <- read_excel(here::here('data/1_skills.xlsx'), 
                    sheet = 'Industry Skills Needs')

mydat$industry_name <- as.factor(mydat$industry_name)
mydat$isic_section_name <- as.factor(mydat$isic_section_name)
mydat$skill_group_category <- as.factor(mydat$skill_group_category)

##TABLES:
#skill category frequency by industry section:
mydat %>% 
  group_by(isic_section_name) %>%
  count(mydat$skill_group_category) %>% arrange(desc(n))

#top 1 skill in every industry section:
section_top1 <- mydat %>% 
  count(isic_section_name,skill_group_category ) %>%
  arrange(desc(n)) %>% 
  group_by(isic_section_name) %>% 
  slice(seq_len(1)) 

##PLOTS:
#set consistent color scheme:
skillColors <-
  setNames( c('wheat4', 'coral', 'azure','lightpink4','thistle4')
            , levels(mydat$skill_group_category)  )

#plot bar chart across inductry section:
ggplot(section_top1, mapping = aes(x=isic_section_name,y=n,fill=skill_group_category))+geom_bar(stat = 'identity')+xlab('Industry Section')+ylab('Frequency')+ggtitle('Most Common Skill Category by Industry Section')+scale_fill_manual(values = skillColors)+coord_flip()
```

From the bar chart above, we can see the most common skill category within each industry section. Specialized Industry Skills are the most common skill category in 4 out of 6 industry sections.It be used more frequently in professional scientific and technical activities than the others. And tech skills are the most common in Information and Communication, because of the advanced technique is required by this occupation. In financial and insurance activities, people will often have a business conversation so the business skills are the most common skills needed by in this industry.

```{r,fig.width=9,fig.height=4}
#skill category frequency by industry section - descending order:
section_topn <- mydat %>% 
  count(isic_section_name,skill_group_category ) %>%
  arrange(desc(n)) %>% 
  group_by(isic_section_name) %>% 
  slice(seq_len(5)) 

#Get the levels for type in the required order
section_topn2 <- arrange(section_topn,desc(skill_group_category))

#Calculate the percentages
library(plyr)
section_topn2 <- ddply(section_topn2,.(isic_section_name),transform, percent = n/sum(n) * 100)

#Format the labels and calculate their positions
section_topn2  = ddply(section_topn2,.(isic_section_name),transform, pos = (cumsum(n) - 0.5 * n))
section_topn2$label = paste0(sprintf("%.0f", section_topn2$percent), "%")

#Plot
ggplot(section_topn2, aes(x = isic_section_name, y = n, fill = skill_group_category, label=label)) +
  geom_bar(stat = 'identity', position = position_fill()) +
  geom_text(position = position_fill(vjust = .5)) + ggtitle('Skill Category Distribution by Industry Section')+ylab('percent')+xlab('Industry Section')+scale_fill_manual(values = skillColors)+coord_flip()
```
The above 100% stacked bar chart shows the skill category distribution within each industry section. While 4 out of 6 industry sections have a similar skill category distribution, Financial & Insurance Activities and Arts, Entertainment & Recreation have a rather different skill category distribution. Business skills are greatly needed (61%) while Tech skills are much less needed comparably for Financial industry. Specialized skills(53%) and Tech skills(24%) are majorly needed for Arts and Entertainment industry while Business skills (6%) and Disruptive Tech skills (0)are the least needed types for the industry section. 


Overall,specialized Industry Skills are the most common skill in professional scientific and technical activities. While business skills are the most important thing for people to acquire in financial and insurance activities.


2) **What is the average percentage of net migration for each industry over the past five years and Is the growth rate of immigration within the industry related to the growth rate of the industry?** **(Jiaying Zhang)**

```{r read-data}
mgindustry <- read_csv(here::here("data/migration_industry.csv"))
growindustry<- read_csv(here::here("data/3_employment_growth.csv"))
```
```{r datacleaning, include=FALSE}
mgpick <- mgindustry %>% 
  select(industry_name,
         industry_id,
         isic_section_index,
         isic_section_name,
                net_per_10K_2015,
                net_per_10K_2016,
                net_per_10K_2017,
                net_per_10K_2018,
                net_per_10K_2019) %>% 
  filter(isic_section_name != 'Not_mapped')
growpick <- growindustry %>% 
  select(industry_name, 
         industry_id,
                growth_rate_2015,
                growth_rate_2016,
                growth_rate_2017,
                growth_rate_2018,
                growth_rate_2019)

```
2.1 Average percentage of net migration for each industry Section and industry over the past five years

```{r mgdatause}
mguse<- mgpick %>% 
   rename(c("2015"= "net_per_10K_2015",
           "2016"= "net_per_10K_2016",
           "2017"= "net_per_10K_2017",
           "2018"= "net_per_10K_2018",
           "2019"= "net_per_10K_2019",
           "industry" = "industry_name",
           "industry_section"= "isic_section_index",
           "section_name" = "isic_section_name")) %>% 
    pivot_longer(cols = 5:9,  
               names_to = "year",            
               values_to = "net_migration_rate") %>% 
 mutate(migration_year= year,
        migration_industry_id = industry_id) %>% 
 unite("industry_year", migration_industry_id, year)
```
```{r mgave}
mgave <- mguse %>% 
  group_by(industry_year) %>% 
  summarise(average_migration_rate = mean(net_migration_rate, na.rm = TRUE),
            industry_section_index = industry_section,
            industry_section = section_name) 
```
```{r mgfinal}
mgfinal <- mgave %>% separate(industry_year,
           c("industry","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  group_by(industry_section_index) %>% 
  arrange(desc(average_migration_rate))
```
```{r vis, fig.width=12, fig.cap="Net migration for each industry section"}
mgvis <- mgfinal %>%
ggplot(aes(industry_section,
       average_migration_rate,fill= industry_section)) +
  geom_boxplot() + 
   ggtitle("Net migration for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis)
```
The figure \@ref(fig:vis)  shows

- There are some differences in each industry, but the differences are not large.

- From the median, the growth of Public administration and defence; compulsory social security was the slowest, and some years was negative 

- Although the median of Public administration and defence is the highest, the industries with the highest immigration rate are in education and finance industry section.

```{r vis3, fig.width=12, fig.cap="The industry with highest net migration rate for each industry section"}
mgvisuse <- mguse %>%
    select(industry, section_name, migration_year, net_migration_rate) %>% group_by(section_name, industry) 
  mgvis2<- mgvisuse %>% 
    summarise(average_migration_rate = mean(net_migration_rate, na.rm = TRUE)) %>%
  arrange(desc(average_migration_rate)) %>%
  slice(1) %>% 
ggplot(aes(industry,
       average_migration_rate,
       fill = section_name)) +
  geom_col()+
   ggtitle("The industry with highest net migration rate for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis2)
```
The figure \@ref(fig:vis3) shows 

- The highest value of the Public administration and defence category is found in the Public Policy industry(82). 

- However the highest industry is the Financial and insurance activities industry, which reaches about 272.

2.2 Is the growth rate of immigration within the industry related to the growth rate of the industry?

```{r relationdata}
growuse <- growpick %>% 
   rename(c("2015"= "growth_rate_2015",
           "2016"= "growth_rate_2016",
           "2017"= "growth_rate_2017",
           "2018"= "growth_rate_2018",
           "2019"= "growth_rate_2019"
           )) %>% 
    pivot_longer(cols = 3:7,  
               names_to = "year",            
               values_to = "growth_rate") %>% 
 unite("industry_year", industry_id, year)
growclean <- growuse %>% 
  mutate(growth_rate = str_sub(growuse$growth_rate,start = 1, end = -2))%>% 
  mutate(growth_rate = as.numeric(growth_rate)) %>% 
  na.omit()
```

```{r growave}
growave <- growclean %>% 
  group_by(industry_year) %>% 
summarise(average_grow_rate = mean(growth_rate, na.rm = TRUE))
```
```{r full}
fulldata<- mgave %>% 
  inner_join(growave, by="industry_year")
```

```{r finaldata}
cleandata <- fulldata %>% separate(industry_year,
           c("industry_section","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  unique()
```

```{r vis2,  fig.width=8, fig.cap="Relationship between migration growth and industry growth"}
mgandinvis <- ggplot(data = cleandata,
       aes(x = cleandata$average_grow_rate, y = cleandata$average_migration_rate)) +
  geom_point() +
  geom_smooth(method = "lm")+
  xlab("industry growth rate")+
  ylab("migration growth rate")+
  ggtitle("Relationship between migration growth and industry growth")

 ggplotly(mgandinvis)
```
```{r, include = FALSE}
growmodel <- lm(cleandata$average_migration_rate ~ cleandata$average_grow_rate, data = cleandata)
coef(growmodel)
```
Then the fitted model will be:
$$\widehat{\text{migration growth rate}} = 64.14528   + 26.19208   ~\text{industry growth rate} $$
The figure  \@ref(fig:vis2) shows

- There is a positive correlation between the growth of industry and the growth of immigration. 

- It's not very obvious but we can infer that in most industries when the industry is growing fast it attracts more immigrants, and more immigrants also promote the development of the industry. 

- On average, every 1 increase in the industry growth, the net immigrants rates in that industry increases by about 26.1.

Conclusion:

- over the past five years, the average net migration rate by industry section has not varied much but the differences are large for each industry.

- The industry section of administrative and support service activities has the highest average value, reaching around 74.22. However Venture Capital and Private Equity industry which is in financial and insurance activities industry section have the highest value of about 272 and E-learning in the education industry is close behind at about 242. 

- In addition, we found that there is a positive correlation between industry development and net immigration rate. On average, for every unit of industry increased, net immigration increased by about 26 units.




3) **For each common skill_category, which industry has the highest penetration rate and what is the change of the common skill penetration rate over the period of time?** **(Hanchen Wang)**


# Data Descripion

“2_skill_penetration.csv” is the data showing skill profiles for each global industry and penetration of LinkedIn skill groups at the global industry level from 2015 to 2019, which penetration means the weight of one skill occupied each industry.

The old data (“2_skill_penetration.csv”) is 30,740 × 7 variables and the cleaned clean data (“2_skill_penetration_clean.csv”) is 4156 × 9.

```{r read data}
penetration_raw <- 
  read_csv(here::here('data/2_skill_penetration.csv'))

```


```{r data cleaning}
penetration_clean <- penetration_raw %>% 
  select(!isic_section_index) %>% 
  pivot_wider(names_from = year, 
              values_from = skill_group_penetration_rate) %>% 
  select(skill_group_category:"2019") %>% 
  rename(penetration_rate_2015 = "2015", penetration_rate_2016 = "2016", 
         penetration_rate_2017 = "2017", penetration_rate_2018 = "2018", 
         penetration_rate_2019 = "2019", section_name = isic_section_name) %>% 
  na.omit() %>% 
  mutate(penetration_rate_2015 = as.numeric((unlist(penetration_rate_2015))), 
         penetration_rate_2016 = as.numeric((unlist(penetration_rate_2016))), 
         penetration_rate_2017 = as.numeric((unlist(penetration_rate_2017))), 
         penetration_rate_2018 = as.numeric((unlist(penetration_rate_2018))), 
         penetration_rate_2019 = as.numeric((unlist(penetration_rate_2019)))
         )


```


```{r read cleaned data}
penetration_tidy_1 <- read_csv(here::here('data/2_skill_penetration_clean.csv')) %>% 
  select(!X1)

```


```{r tidy data}
penetration_tidy <- penetration_tidy_1 %>% 
  rename("2015" = penetration_rate_2015, 
         "2016" = penetration_rate_2016, 
         "2017" = penetration_rate_2017, 
         "2018" = penetration_rate_2018, 
         "2019" = penetration_rate_2019) %>% 
  pivot_longer(cols = "2015":"2019", 
               names_to = "year", 
               values_to = "penetration_rate")
```




```{r make function}
Q3_dat2015 <- function(x){
  penetration_tidy %>%
  filter(skill_group_category == x, year == "2015") %>% 
  group_by(industry_name) %>% 
  slice_max(penetration_rate) %>% 
  arrange(desc(penetration_rate)) %>% 
  head(1)
}

Q3_dat2016 <- function(x){
  penetration_tidy %>%
  filter(skill_group_category == x, year == "2016") %>% 
  group_by(industry_name) %>% 
  slice_max(penetration_rate) %>% 
  arrange(desc(penetration_rate)) %>% 
  head(1)
}

Q3_dat2017 <- function(x){
  penetration_tidy %>%
  filter(skill_group_category == x, year == "2017") %>% 
  group_by(industry_name) %>% 
  slice_max(penetration_rate) %>% 
  arrange(desc(penetration_rate)) %>% 
  head(1)
}

Q3_dat2018 <- function(x){
  penetration_tidy %>%
  filter(skill_group_category == x, year == "2018") %>% 
  group_by(industry_name) %>% 
  slice_max(penetration_rate) %>% 
  arrange(desc(penetration_rate)) %>% 
  head(1)
}

Q3_dat2019 <- function(x){
  penetration_tidy %>%
  filter(skill_group_category == x, year == "2019") %>% 
  group_by(industry_name) %>% 
  slice_max(penetration_rate) %>% 
  arrange(desc(penetration_rate)) %>% 
  head(1)
}

```
  


```{r combine the fuction and make the table}

Q3_dat2015_b <- bind_rows(Q3_dat2015("Business Skills"), 
                       Q3_dat2015("Disruptive Tech Skills"), 
                       Q3_dat2015("Soft Skills"), 
                       Q3_dat2015("Specialized Industry Skills"), 
                       Q3_dat2015("Tech Skills")
)

Q3_dat2016_b <- bind_rows(Q3_dat2016("Business Skills"), 
                       Q3_dat2016("Disruptive Tech Skills"), 
                       Q3_dat2016("Soft Skills"), 
                       Q3_dat2016("Specialized Industry Skills"), 
                       Q3_dat2016("Tech Skills")
)

Q3_dat2017_b <- bind_rows(Q3_dat2017("Business Skills"), 
                       Q3_dat2017("Disruptive Tech Skills"), 
                       Q3_dat2017("Soft Skills"), 
                       Q3_dat2017("Specialized Industry Skills"), 
                       Q3_dat2017("Tech Skills")
)

Q3_dat2018_b <- bind_rows(Q3_dat2018("Business Skills"), 
                       Q3_dat2018("Disruptive Tech Skills"), 
                       Q3_dat2018("Soft Skills"), 
                       Q3_dat2018("Specialized Industry Skills"), 
                       Q3_dat2018("Tech Skills")
)

Q3_dat2019_b <- bind_rows(Q3_dat2019("Business Skills"), 
                       Q3_dat2019("Disruptive Tech Skills"), 
                       Q3_dat2019("Soft Skills"), 
                       Q3_dat2019("Specialized Industry Skills"), 
                       Q3_dat2019("Tech Skills")
)

Q3_dat_total <- bind_rows(Q3_dat2015_b, Q3_dat2016_b, Q3_dat2017_b, Q3_dat2018_b, Q3_dat2019_b)

```

# The highest penetration rate for different industry

```{r Q3fig2, fig.width=12, fig.cap="The penetration rate for different industry"}
Q3_dat_fig_2 <- Q3_dat_total %>% ggplot(aes(x = reorder(industry_name, 
                                                        penetration_rate), 
                                            y = penetration_rate, 
                                            fill = industry_name)) + 
  geom_col() + 
  theme_bw() + 
  xlab("Industry section") + 
  ylab("Peneration rate") + 
  scale_y_continuous(breaks=seq(0, 0.3, 0.05)) + 
  facet_wrap(~year, , scales = "free_y",
             ncol = 1, 
             strip.position = "right") 

Q3_dat_fig_2 <- ggplotly(Q3_dat_fig_2)

Q3_dat_fig_2[['x']][['layout']][['annotations']][[2]][['x']] = -0.05 
Q3_dat_fig_2[['x']][['layout']][['annotations']][[1]][['y']] = -0.05
Q3_dat_fig_2 %>% layout(margin = list(l = 75)) 
```

The figure \@ref(fig:Q3fig2) demonstrates that music industry has the highest skill penetration rate at 25% on average, graphic design ranked the second (22%), insurance ranked the third(9%) and writing & editing ranked the third (8%). In addition, aviation & aerospace ranked last in 2015(3%), but were replaced by computer software(5%) in the following years.

# The change of the common skill penetration rate

```{r Q3fig1, fig.width=12, fig.cap="Change for skill peneration rate"}
Q3_dat_fig_1 <- Q3_dat_total %>% ggplot(aes(x = year, 
                                            y = penetration_rate, 
                                            color = skill_group_category, 
                                            group = skill_group_category)) + 
  geom_point() + 
  geom_line() + 
  xlab("Year") + 
  ylab("Skill peneration rate") +
  theme_bw()+
  labs(title = "Change for skill peneration rate") + 
  scale_y_continuous(breaks=seq(0, 0.29, 0.02)) 

 ggplotly(Q3_dat_fig_1)
```
The figure \@ref(fig:Q3fig1) shows that  specialized industry skills ranking first which peaked at 27% in 2017 had fluctuation during the time period while tech skills(2nd, average 22%) keep steadily. And soft skills had a slight climb until exceeding business skills in mid-2017(8%) which had a downwad trend. However, disruptive tech skills ranks the last with 5% on average.



# Conclusion
From the two figures, it is not hard to find that if workers want to enter an industry with a strong professional field, they are often required to master a unique and high threshold skill, such as music and graphic design. While industries with low technical penetration may require more alternative skills due to the fragmentation of the industry. Therefore it is true that the skill penetration rate of an industry is effected by various factors such as the degree of internal segmentation of the industry and the industry itself.

In general, hundreds of skills can be categorized by five common skills. Undoubtedly the specialized industry skills and tech skills has the higher rate which meet the requirements of industry development. Interestingly, With the advent of the era of big data and technology, the importance of many traditional skills like business skill has gradually declined, as shown in the decreasing penetration rate, which means that they are more substitutable in the industry and therefore no longer unique.






```{r export cleaned data}
write.csv(penetration_clean, here::here("data/2_skill_penetration_clean.csv"))
```

4) **Find the industry_section that is best to each region/continent.**

```{r reading_data}

skills_raw <- read_excel(here::here('data/1_skills.xlsx'), sheet=4)
penetration_raw <- read_excel(here::here('data/3_skill_penetration.xlsx'), sheet=4)
emp_growth_raw <- read_excel(here::here('data/456_employment_growth.xlsx'), sheet=4)


```
```{r}
# tidy emp_growth_raw

temp <- emp_growth_raw %>% select(starts_with("growth")) %>% names()
emp_growth_raw_long <- emp_growth_raw %>%
                          pivot_longer(cols = all_of(temp), 
                                       names_to = "year", 
                                       values_to = "growth_rate") %>%
                      separate(year, into = c("temp1","temp2","year"), convert = TRUE) %>%
                      select(-starts_with("temp"))
head(emp_growth_raw)
```

```{r Q4-part1,eval=TRUE}
emp_growth_raw_long %>% 
  group_by(wb_region,isic_section_name) %>% 
  summarise(Avg_growth_rate = round(mean(growth_rate),3)) %>% 
  arrange(wb_region,desc(Avg_growth_rate)) %>% 
  slice_max(Avg_growth_rate,n = 1) %>%
  rename(region = wb_region,
         Industry_section = isic_section_name) %>%  
  kable(caption = "Region wise best Industry section") %>% 
   kable_styling(bootstrap_options = c("basic","striped,hover")) 

```

```{r Q4-graph,ehco = TRUE,fig.width=15,fig.height=10}
emp_growth_raw_long %>% 
  group_by(wb_region,isic_section_name) %>% 
  summarise(Avg_growth_rate = round(mean(growth_rate),3)) %>% 
  arrange(wb_region,desc(Avg_growth_rate)) %>% 
  mutate(isic_section1 = reorder_within(isic_section_name,Avg_growth_rate,wb_region)) %>% 
  ggplot(aes(Avg_growth_rate,
             isic_section1,
             fill = isic_section_name)) +
  geom_col() +
  geom_text(aes(label = Avg_growth_rate)) +
  scale_y_reordered() +
  xlab("Average Growth Rate") +
  ylab("Indutry Section type") +
  facet_wrap(~wb_region,ncol = 2,scales = "free")

```

Q5) Which industry_name sees the maximum growth over time in each region/continent , depending on the region’s best industry_section ? **(Mohammed Faizan)**


# EDA
```{r}
#some summaries
#joining skills and penetration data

skill_penetration_common <- skills_raw %>%
                            inner_join(penetration_raw,
                                       by=c("year"="year",
                                          "isic_section_index"="isic_section_index",
                                       "isic_section_name"="isic_section_name",
                                       "skill_group_category"="skill_group_category",
                                       "skill_group_name"="skill_group_name",
                                       "industry_name"="industry_name")
                                       ) %>%
                            select(-isic_section_index)

#some summaries
unique(skill_penetration_common$year)
unique(skill_penetration_common$isic_section_name)
unique(skill_penetration_common$skill_group_category)

skill_penetration_common%>%ggplot()+geom_count(mapping = aes(x=isic_section_name,skill_group_category))+theme(axis.text.x = element_text(angle = 60))
```

```{r }
##TABLES:
#skill category frequency by industry section:
skillsbyindustrysection <- mydat %>% #only skills
  group_by(isic_section_name) %>%
  count(mydat$skill_group_category) %>% arrange(isic_section_name, -n)

skillsbyindustrysection%>%ggplot()+geom_col(mapping = aes(x=`mydat$skill_group_category`, y= n, fill =`mydat$skill_group_category` ))+theme(axis.text.x = element_blank())+ facet_grid(.~isic_section_name)

#mining requires labour and these skills do not fit in.
# Business skills and soft skills are important to every field except mining and arts
# specailised industry skills are highest except for finance.

#all skills required by all industries except for mining and quarrying which does not require disruptive tech skills. soft skills importance remains same across industy sections.

mydat%>%ggplot()+geom_count(mapping = aes(x=isic_section_name,skill_group_category))+theme(axis.text.x = element_text(angle = 60))

```

```{r }

industry_info <- skill_penetration_common %>% select(isic_section_name,industry_name) %>%
                  group_by(isic_section_name) %>% count(industry_name) 

industries_sections <- unique(skill_penetration_common$isic_section_name)

industries_function <- function(x) {
     industry_info %>%
       filter(isic_section_name == x)%>%
       group_by(industry_name) %>%
    summarise(count = sum(n)) %>%
    arrange(desc(count)) 

   }
   
    IMQ <- industries_function(industries_sections[1]) %>% 
      rename(`Mining and quarrying` = industry_name)
    IM <- industries_function(industries_sections[2]) %>% 
      rename(`Manufacturing` = industry_name)
    IICT <- industries_function(industries_sections[3]) %>% 
      rename(`Information and communication` = industry_name)
    IFIA <- industries_function(industries_sections[4]) %>% 
      rename(`Financial and insurance activities` = industry_name)
    IPSTA <- industries_function(industries_sections[5]) %>% 
      rename(`Professional scientific and technical activities` = industry_name)
    IAER <- industries_function(industries_sections[6]) %>% 
      rename(`Arts, entertainment and recreation` = industry_name)


industries <- industry_info%>%pivot_wider(id_cols= c(isic_section_name, industry_name), names_from = isic_section_name, values_from = n)
industry_info%>%ggplot()+geom_bar(aes(x=isic_section_name))+coord_flip()+labs(title = "Industry Count within each Section")
```

```{r}

skills_info <- skill_penetration_common %>% select(skill_group_category,skill_group_name) %>%
                  group_by(skill_group_category) %>% count(skill_group_name)

skill_groups <- unique(skill_penetration_common$skill_group_category)


skills_function <- function(x) {
     skills_info %>%
       filter(skill_group_category == x)%>%
       group_by(skill_group_name) %>%
    summarise(count = sum(n)) %>%
    arrange(desc(count)) 

   }
   
    SSIS <- skills_function(skill_groups[1]) %>% 
      rename(`Specialized Industry Skills` = skill_group_name) %>%
      left_join(skill_penetration_common %>% 
                  select(skill_group_name, isic_section_name), 
                by = c("Specialized Industry Skills" = "skill_group_name")) %>% 
      distinct()
    SSS <- skills_function(skill_groups[2]) %>% 
      rename(`Soft Skills` = skill_group_name)
    SBS <- skills_function(skill_groups[3]) %>% 
      rename(`Business Skills` = skill_group_name)
    STS <- skills_function(skill_groups[4]) %>% 
      rename(`Tech Skills` = skill_group_name)
    SDTS <- skills_function(skill_groups[5]) %>% 
      rename(`Disruptive Tech Skills` = skill_group_name)
    

skills <- skills_info%>%pivot_wider(id_cols= c(skill_group_category, skill_group_name), names_from = skill_group_category, values_from = skill_group_name)


skills_info%>%ggplot()+geom_bar(aes(x=skill_group_category))+coord_flip()+labs(title = "Skill Count within each Skill Category")

#investigate specilised industry skills
SSIS %>% 
  ggplot() + 
  geom_count(mapping = aes(x=isic_section_name,
                           y=`Specialized Industry Skills`)) + 
  theme(axis.text.x = element_text(angle = 60))

```

```{r eda_emp_growth}
pct_miss(emp_growth_raw_long) #no missingness
length(unique(emp_growth_raw_long$country_name))
length(unique(emp_growth_raw_long$industry_name))
unique(emp_growth_raw_long$wb_region)
unique(emp_growth_raw_long$wb_income)
unique(emp_growth_raw_long$isic_section_name)
unique(emp_growth_raw_long$year)

```

```{r}

gfun <- function(x){
  temp <- emp_growth_raw_long%>%filter(year==x)
  return(temp)
}
emp_growth_yearwise <- list(gfun(2015),gfun(2016),gfun(2017),gfun(2018),gfun(2019))

```


```{r}
#for each region, every year there same number of records for each industry_section
emp_growth_raw_long%>%count(wb_region,isic_section_name,year)%>%pivot_wider(id_cols = c(year,n,wb_region,isic_section_name),names_from = year, values_from=n) 

emp_growth_raw_long%>%count(wb_region,isic_section_index,year)%>%ggplot()+geom_col(mapping = aes(x=isic_section_index,y=n,fill=as.character(year)),position ="dodge")+facet_wrap(~wb_region)#+theme(axis.text.x = element_blank())

#presence of industries in each region
emp_growth_raw_long %>%
  ggplot()+geom_count(mapping=aes(x=wb_region, y=isic_section_name))+theme(axis.text.x = element_text(angle = 45))

# emp_growth_raw_long %>% 
#   filter(wb_region == "North America") %>%
#   ggplot() +
#   geom_count(mapping=aes(x=isic_section_name,
#                          y=country_name, 
#                          aspect.ratio = 80/9)) +
#   theme(axis.text.x = element_text(angle = 45)) 


```

```{r}
emp_growth_long <- emp_growth_raw_long %>%
  group_by(isic_section_name, industry_name, wb_income, year) %>%
  mutate(avg_gr_income = mean(growth_rate)) %>%
  ungroup(isic_section_name, industry_name, wb_income, year)%>%
  group_by(isic_section_name, industry_name,wb_region, year) %>%  
  mutate(avg_gr_region = mean(growth_rate)) %>%
  ungroup(isic_section_name, industry_name,wb_region, year) %>%  
  group_by(isic_section_name, industry_name, year) %>%  
  mutate(avg_gr_year = mean(growth_rate)) %>%
  ungroup(isic_section_name, industry_name, year) 

```

```{r}
growth_penentration <- emp_growth_long %>%
  select(year,isic_section_name, industry_name, avg_gr_year) %>%
  distinct() %>%
  right_join(penetration_raw) %>%
  distinct()


#penetration is higher where there is no growth or little growth incorporating more skills.
growth_penentration %>%
  ggplot() + 
  geom_point(mapping=aes(x=skill_group_penetration_rate, 
                         y=avg_gr_year)) +
  theme(axis.text.x = element_text(angle = 45))
  
```


```{r}
country_info <- emp_growth_raw %>% select(country_name,wb_region ) %>%
                 count(country_name,wb_region ) %>%
                arrange(wb_region, -n)
```










Q6) For each region, which country did the above found industry had had maximum growth? And, what is the income group of that nation? **(Karan Garg)**

```{r read-data,include=FALSE}
growth <- read.csv(here::here("data/industry-employment-growth.csv"))
```

```{r clean_data,include=FALSE}
growth_tidy <- growth %>% 
  pivot_longer(cols = 9:13,
               names_to = "year",
               values_to = "growth_rate") %>% 
  separate(year,into=c("temp1","temp2","year"),sep = "_") %>% 
  select(-c(temp1,temp2))

  
```

```{r write-data}
write.csv(growth_tidy,here::here("data/industry-employment-growth-cleaned.csv"))
```

# Data Descripion

This Data describes the Industry wise Employement growth across the years from 2015-2019. It further showcases the growth rate depending upon various variables such as Country, Region/Continentm, Industry Section and within each section variioous Industries.

The dimensions of the cleaned data set are 36675 X 10.

## Data Source

1) [The LinkedIn-World Bank Digital Data for Development:Industry Jobs and Skills Trends - About](https://linkedindata.worldbank.org/about)
 
2) [The World Bank: Industry Skills Needs Dataset(3500 X 7), Skill Penetration Dataset(20780 X 7)](https://datacatalog.worldbank.org/dataset/skills-linkedin-data)

3) [The World Bank: Talent Migration Dataset(Industry Migration-5295 X 13)](https://datacatalog.worldbank.org/dataset/talent-migration-linkedin-data)

4) [The World Bank: Industry Employment Shifts Dataset(7335 X 13)](https://datacatalog.worldbank.org/dataset/employment-growth-linkedin-data)

5) [The World Bank: Terms of Use for Datasets(CC BY 4.0)](https://www.worldbank.org/en/about/legal/terms-of-use-for-datasets)