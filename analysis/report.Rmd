---
title: "ETC1010-5510 Project - T11_Wed_skimr"
subtitle: "A Report On The LinkedIn-World Bank Data for Development"
author: "Hanchen Wang 30704456, Hao Li 32041594, Jiaying Zhang 30930685, Mohammed Faizan 31939872, Karan Garg 32106580"
date: "28 April 2021"
output: 
  bookdown::html_document2
keep_md: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
<<<<<<< HEAD
#loading packages

=======

#loading packages

>>>>>>> Jiaying
library(tidyverse) 
library(plotly)
library(naniar)
library(visdat)
library(bookdown)
library(knitr)
library(ggplot2)
library(lubridate)
library(geosphere)
library(ggmap)
library(ggthemes)
library(maps)
library(patchwork)
library(here)
library(readxl)
library(readr)
```
#QUESTIONS

1) **Which skill category is most common across all Industry Sections and how does it vary between each section?**

<<<<<<< HEAD

##data description: The data is about what skills are needed most in different industries
## Question1. Which skill category is most common across all Industry Sections and how does it vary between each section? 

The most common skill category across different sections is Business Skills. 

```{r, fig.width=8,fig.height=4}
mydat <- read_excel('5510public_use-industry-skills-needs clean.xlsx', 
                    sheet = 'Industry Skills Needs')

mydat$industry_name <- as.factor(mydat$industry_name)
mydat$isic_section_name <- as.factor(mydat$isic_section_name)
mydat$skill_group_category <- as.factor(mydat$skill_group_category)

##TABLES:
#skill category frequency by industry section:
mydat %>% 
  group_by(isic_section_name) %>%
  count(mydat$skill_group_category) %>% arrange(desc(n))

#top 1 skill in every industry section:
section_top1 <- mydat %>% 
  count(isic_section_name,skill_group_category ) %>%
  arrange(desc(n)) %>% 
  group_by(isic_section_name) %>% 
  slice(seq_len(1)) 

##PLOTS:
#set consistent color scheme:
skillColors <-
  setNames( c('wheat4', 'coral', 'azure','lightpink4','thistle4')
            , levels(mydat$skill_group_category)  )

#plot bar chart across inductry section:
ggplot(section_top1, mapping = aes(x=isic_section_name,y=n,fill=skill_group_category))+geom_bar(stat = 'identity')+xlab('Industry Section')+ylab('Frequency')+ggtitle('Most Common Skill Category by Industry Section')+scale_fill_manual(values = skillColors)+coord_flip()
```

From the bar chart above, we can see the most common skill category within each industry section. Specialized Industry Skills are the most common skill category in 4 out of 6 industry sections. Tech skills are the most common within Information and Communication, Business Skills are the most common within Financial and Insurance Activities. 

```{r,fig.width=9,fig.height=4}
#skill category frequency by industry section - descending order:
section_topn <- mydat %>% 
  count(isic_section_name,skill_group_category ) %>%
  arrange(desc(n)) %>% 
  group_by(isic_section_name) %>% 
  slice(seq_len(5)) 

#Get the levels for type in the required order
section_topn2 <- arrange(section_topn,desc(skill_group_category))

#Calculate the percentages
library(plyr)
section_topn2 <- ddply(section_topn2,.(isic_section_name),transform, percent = n/sum(n) * 100)

#Format the labels and calculate their positions
section_topn2  = ddply(section_topn2,.(isic_section_name),transform, pos = (cumsum(n) - 0.5 * n))
section_topn2$label = paste0(sprintf("%.0f", section_topn2$percent), "%")

#Plot
ggplot(section_topn2, aes(x = isic_section_name, y = n, fill = skill_group_category, label=label)) +
  geom_bar(stat = 'identity', position = position_fill()) +
  geom_text(position = position_fill(vjust = .5)) + ggtitle('Skill Category Distribution by Industry Section')+ylab('percent')+xlab('Industry Section')+scale_fill_manual(values = skillColors)+coord_flip()
```
The above 100% stacked bar chart shows the skill category distribution within each industry section. While 4 out of 6 industry sections have a similar skill category distribution, Financial & Insurance Activities and Arts, Entertainment & Recreation have a rather different skill category distribution. Business skills are greatly needed (61%) while Tech skills are much less needed comparably for Financial industry. Specialized skills(53%) and Tech skills(24%) are majorly needed for Arts and Entertainment industry while Business skills (6%) and Disruptive Tech skills (0)are the least needed types for the industry section. 

2) **What is the average percentage of net migration for each industry over the past five years and Is the growth rate of immigration within the industry related to the growth rate of the industry?**
=======
2) **What is the average percentage of net migration for each industry over the past five years and Is the growth rate of immigration within the industry related to the growth rate of the industry?**
```{r read-data}
mgindustry <- read_csv(here::here("data/migration_industry.csv"))
growindustry<- read_csv(here::here("data/3_employment_growth.csv"))
```
```{r datacleaning, include=FALSE}
mgpick <- mgindustry %>% 
  select(industry_name,
         industry_id,
         isic_section_index,
         isic_section_name,
                net_per_10K_2015,
                net_per_10K_2016,
                net_per_10K_2017,
                net_per_10K_2018,
                net_per_10K_2019)
growpick <- growindustry %>% 
  select(industry_name, 
         industry_id,
                growth_rate_2015,
                growth_rate_2016,
                growth_rate_2017,
                growth_rate_2018,
                growth_rate_2019)

```
#average percentage of net migration for each industry over the past five years

```{r mgdatause}
mguse<- mgpick %>% 
   rename(c("2015"= "net_per_10K_2015",
           "2016"= "net_per_10K_2016",
           "2017"= "net_per_10K_2017",
           "2018"= "net_per_10K_2018",
           "2019"= "net_per_10K_2019",
           "industry" = "industry_name",
           "industry_section"= "isic_section_index",
           "section_name" = "isic_section_name")) %>% 
    pivot_longer(cols = 5:9,  
               names_to = "year",            
               values_to = "net_migration_rate") %>% 
 mutate(migration_year= year,
        migration_industry_id = industry_id) %>% 
 unite("industry_year", migration_industry_id, year)
```
```{r mgave}
mgave <- mguse %>% 
  group_by(industry_year) %>% 
  summarise(average_migration_rate = mean(net_migration_rate, na.rm = TRUE),
            industry_section_index = industry_section) 
```
```{r mgfinal}
mgfinal <- mgave %>% separate(industry_year,
           c("industry","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  group_by(industry_section_index)
```

#Is the growth rate of immigration within the industry related to the growth rate of the industry?

```{r relationdata}
growuse <- growpick %>% 
   rename(c("2015"= "growth_rate_2015",
           "2016"= "growth_rate_2016",
           "2017"= "growth_rate_2017",
           "2018"= "growth_rate_2018",
           "2019"= "growth_rate_2019"
           )) %>% 
    pivot_longer(cols = 3:7,  
               names_to = "year",            
               values_to = "growth_rate") %>% 
 unite("industry_year", industry_id, year)
growclean <- growuse %>% 
  mutate(growth_rate = str_sub(growuse$growth_rate,start = 1, end = -2))%>% 
  mutate(growth_rate = as.numeric(growth_rate)) %>% 
  na.omit()
```

```{r growave}
growave <- growclean %>% 
  group_by(industry_year) %>% 
summarise(average_grow_rate = mean(growth_rate, na.rm = TRUE))
```
```{r full}
fulldata<- mgave %>% 
  inner_join(growave, by="industry_year")
```

```{r finaldata}
cleandata <- fulldata %>% separate(industry_year,
           c("industry_section","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  unique()
```
>>>>>>> Jiaying

3) **For each industry_section, which industry has the highest penetration rate for the most common skill_category?**

4) **Find the industry_section that is best to each region/continent.**

5) **Which industry_name sees the maximum growth over time in each region/continent , depending on the regionâ€™s best industry_section?**

6) **For each region, which country did the above found industry had had maximum growth? And, what is the income group of that nation?**

<<<<<<< HEAD
=======

>>>>>>> Jiaying
