---
title: "my Q1"
author: "HaoLi"
date: "5/7/2021"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
library(ggplot2)
library(tidyverse)
library(readxl)

```

## Question1. Which skill category is most common across all Industry Sections and how does it vary between each section? 

"The Industry Skills Needs metric captures which skills are most likely to be added to a member's profile in one industry compared to other industries. It's calculated using an adapted version of a text mining technique called Term Frequency - Inverse Document Frequency (TF-IDF). This method gives more weight to a skill for an industry if more members in the industry list the skill on their profiles and the skill is more unique to the industry. The skills included are those added while a member holds a particular occupation (i.e. the skill flow approach). While the skill flow approach creates a trade-off whereby long-held basic skills, such as Microsoft Office being given a lesser weight, the approach is shown to be stronger at identifying the latest emerging skills in a specific industry than including all historical skills that are added during prior occupations. On balance, since the objective of this metric is to detect the latest skills needs, a skill flow approach is adopted." ~ 

The most common skill category across different sections is Business Skills. 

```{r, fig.width=8,fig.height=4}
mydat <- read_excel(here::here('data/1_skills.xlsx'), 
                    sheet = 'Industry Skills Needs')

mydat$industry_name <- as.factor(mydat$industry_name)
mydat$isic_section_name <- as.factor(mydat$isic_section_name)
mydat$skill_group_category <- as.factor(mydat$skill_group_category)

##TABLES:
#skill category count by industry section:
indsec_skilcat <- mydat %>% 
  group_by(isic_section_name) %>%
  count(skill_group_category) %>% arrange(isic_section_name, desc(n))

indsec_skilcat %>% pivot_wider(names_from = isic_section_name,
                               values_from = n)
#top 1 skill category in every industry section:
section_top1 <- indsec_skilcat %>% 
  group_by(isic_section_name) %>% 
  slice(seq_len(1)) 

##PLOTS:
#set consistent color scheme:
skillColors <-
  setNames( c('wheat4', 'coral', 'azure','lightpink4','thistle4'),
            levels(mydat$skill_group_category)  )

#plot bar chart across inductry section:
ggplot(section_top1, mapping= aes(x=isic_section_name,
                                  y=n,
                                  fill=skill_group_category)) +
  geom_bar(stat = 'identity') +
  xlab('Industry Section') + 
  ylab('Frequency') +
  ggtitle('Most Common Skill Category by Industry Section') +
  scale_fill_manual(values = skillColors)+coord_flip()
```

The TF-IDF text mining technique used in calculation for the skill rank includes the skills that are prevalent more and are more unique to one industry than any other. For this reason, for each industry section, Specialized Industry Skills group count is the highest. Specialized Industry Skills are the most common skill category in 4 out of 6 industry sections. However, Information and Communication, has more of Tech Skills, this is owing to the fact the most of the Tech Skills like Microsoft Office are basic across all industries and hence are not categorized as Specialized Industry Skills for ICT. Business Skills(e.g, ) for financial and insurance activities is reasoned in the same manner as above. 

```{r,fig.width=9,fig.height=4}
#Calculate the percentages
library(plyr)
section_topn <- ddply(indsec_skilcat,.(isic_section_name),transform, percent = n/sum(n) * 100)

#Format the labels and calculate their positions
section_topn  = ddply(section_topn,.(isic_section_name),transform, pos = (cumsum(n) - 0.5 * n))
section_topn$label = paste0(sprintf("%.0f", section_topn$percent), "%")

#Plot
ggplot(section_topn, 
       aes(x = isic_section_name, 
           y = n, 
           fill = skill_group_category, 
           label=label)) +
  geom_bar(stat = 'identity', 
           position = position_fill()) +
  geom_text(position = position_fill(vjust = .5)) + 
  ggtitle('Skill Category Distribution by Industry Section') +
  ylab('percent') +
  xlab('Industry Section') +
  scale_fill_manual(values = skillColors) +
  coord_flip()
```
The above 100% stacked bar chart shows the skill category distribution within each industry section. While 4 out of 6 industry sections have a similar skill category distribution, Financial & Insurance Activities and Arts, Entertainment & Recreation have a rather different skill category distribution. This is because Arts, Entertainment & Recreation is a field in which each talent is a skilland thus Specialized Industry Skills(53%)!!! Financial & Insurance Activities commands Soft Skills and Business Skills(61%). Disruptive Tech Skills are not possessed by members belonging to Mining and quarrying.


Overall,specialized Industry Skills are the most common skill in professional scientific and technical activities. While business skills are the most important thing for people to acquire in financial and insurance activities.
