---
title: "ETC1010-5510 Project - T11_Wed_skimr"
subtitle: "A Report On The LinkedIn-World Bank Data for Development"
author: "Hanchen Wang 30704456, Hao Li 32041594, Jiaying Zhang 30930685, Mohammed Faizan 31939872, Karan Garg 32106580"
date: "28 April 2021"
output: 
  bookdown::html_document2
keep_md: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#loading packages

library(tidyverse) 
library(plotly)
library(naniar)
library(visdat)
library(bookdown)
library(knitr)
library(ggplot2)
library(lubridate)
library(geosphere)
library(ggmap)
library(ggthemes)
library(maps)
library(patchwork)
library(here)
library(readxl)
library(readr)
```
#QUESTIONS

2) **What is the average percentage of net migration for each industry over the past five years and Is the growth rate of immigration within the industry related to the growth rate of the industry?**
```{r read-data}
mgindustry <- read_csv(here::here("data/migration_industry.csv"))
growindustry<- read_csv(here::here("data/3_employment_growth.csv"))
```
```{r datacleaning, include=FALSE}
mgpick <- mgindustry %>% 
  select(industry_name,
         industry_id,
         isic_section_index,
         isic_section_name,
                net_per_10K_2015,
                net_per_10K_2016,
                net_per_10K_2017,
                net_per_10K_2018,
                net_per_10K_2019) %>% 
  filter(isic_section_name != 'Not_mapped')
growpick <- growindustry %>% 
  select(industry_name, 
         industry_id,
                growth_rate_2015,
                growth_rate_2016,
                growth_rate_2017,
                growth_rate_2018,
                growth_rate_2019)

```
2.1 Average percentage of net migration for each industry Section and industry over the past five years

```{r mgdatause}
mguse<- mgpick %>% 
   rename(c("2015"= "net_per_10K_2015",
           "2016"= "net_per_10K_2016",
           "2017"= "net_per_10K_2017",
           "2018"= "net_per_10K_2018",
           "2019"= "net_per_10K_2019",
           "industry" = "industry_name",
           "industry_section"= "isic_section_index",
           "section_name" = "isic_section_name")) %>% 
    pivot_longer(cols = 5:9,  
               names_to = "year",            
               values_to = "net_migration_rate") %>% 
 mutate(migration_year= year,
        migration_industry_id = industry_id) %>% 
 unite("industry_year", migration_industry_id, year)
```
```{r mgave}
mgave <- mguse %>% 
  group_by(industry_year) %>% 
  summarise(average_migration_rate = mean(net_migration_rate, na.rm = TRUE),
            industry_section_index = industry_section,
            industry_section = section_name) 
```
```{r mgfinal}
mgfinal <- mgave %>% separate(industry_year,
           c("industry","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  group_by(industry_section_index) %>% 
  arrange(desc(average_migration_rate))
```
```{r vis, fig.width=12, fig.cap="Net migration for each industry section"}
mgvis <- mgfinal %>%
ggplot(aes(industry_section,
       average_migration_rate,fill= industry_section)) +
  geom_boxplot() + 
   ggtitle("Net migration for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis)
```
The figure \@ref(fig:vis)  shows

- There are some differences in each industry, but the differences are not large.

- From the median, the growth of Public administration and defence; compulsory social security was the slowest, and some years was negative 

- Although the median of Public administration and defence is the highest, the industries with the highest immigration rate are in education and finance industry section.

```{r vis3, fig.width=12, fig.cap="The industry with highest net migration rate for each industry section"}
mgvisuse <- mguse %>%
    select(industry, section_name, migration_year, net_migration_rate) %>% group_by(section_name, industry) 
  mgvis2<- mgvisuse %>% 
    summarise(average_migration_rate = mean(net_migration_rate, na.rm = TRUE)) %>%
  arrange(desc(average_migration_rate)) %>%
  slice(1) %>% 
ggplot(aes(industry,
       average_migration_rate,
       fill = section_name)) +
  geom_col()+
   ggtitle("The industry with highest net migration rate for each industry section")+
  theme(axis.text.x = element_blank()) 
 ggplotly(mgvis2)
```
The figure \@ref(fig:vis3) shows 

- The highest value of the Public administration and defence category is found in the Public Policy industry(82). 

- However the highest industry is the Financial and insurance activities industry, which reaches about 272.

2.2 Is the growth rate of immigration within the industry related to the growth rate of the industry?

```{r relationdata}
growuse <- growpick %>% 
   rename(c("2015"= "growth_rate_2015",
           "2016"= "growth_rate_2016",
           "2017"= "growth_rate_2017",
           "2018"= "growth_rate_2018",
           "2019"= "growth_rate_2019"
           )) %>% 
    pivot_longer(cols = 3:7,  
               names_to = "year",            
               values_to = "growth_rate") %>% 
 unite("industry_year", industry_id, year)
growclean <- growuse %>% 
  mutate(growth_rate = str_sub(growuse$growth_rate,start = 1, end = -2))%>% 
  mutate(growth_rate = as.numeric(growth_rate)) %>% 
  na.omit()
```

```{r growave}
growave <- growclean %>% 
  group_by(industry_year) %>% 
summarise(average_grow_rate = mean(growth_rate, na.rm = TRUE))
```
```{r full}
fulldata<- mgave %>% 
  inner_join(growave, by="industry_year")
```

```{r finaldata}
cleandata <- fulldata %>% separate(industry_year,
           c("industry_section","year"), "_") %>% 
  mutate(year = as.numeric(year)) %>% 
  unique()
```

```{r vis2,  fig.width=8, fig.cap="Relationship between migration growth and industry growth"}
mgandinvis <- ggplot(data = cleandata,
       aes(x = cleandata$average_grow_rate, y = cleandata$average_migration_rate)) +
  geom_point() +
  geom_smooth(method = "lm")+
  xlab("industry growth rate")+
  ylab("migration growth rate")+
  ggtitle("Relationship between migration growth and industry growth")

 ggplotly(mgandinvis)
```
```{r, include = FALSE}
growmodel <- lm(cleandata$average_migration_rate ~ cleandata$average_grow_rate, data = cleandata)
coef(growmodel)
```
Then the fitted model will be:
$$\widehat{\text{migration growth rate}} = 64.14528   + 26.19208   ~\text{industry growth rate} $$
The figure  \@ref(fig:vis2) shows

- There is a positive correlation between the growth of industry and the growth of immigration. 

- It's not very obvious but we can infer that in most industries when the industry is growing fast it attracts more immigrants, and more immigrants also promote the development of the industry. 

- On average, every 1 increase in the industry growth, the net immigrants rates in that industry increases by about 26.1.

Conclusion:

- over the past five years, the average net migration rate by industry section has not varied much but the differences are large for each industry.

- The industry section of administrative and support service activities has the highest average value, reaching around 74.22. However Venture Capital and Private Equity industry which is in financial and insurance activities industry section have the highest value of about 272 and E-learning in the education industry is close behind at about 242. 

- In addition, we found that there is a positive correlation between industry development and net immigration rate. On average, for every unit of industry increased, net immigration increased by about 26 units.


